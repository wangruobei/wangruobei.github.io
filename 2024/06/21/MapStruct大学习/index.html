<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>MapStruct大学习 | Doudou&#39;s Blog</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="什么是MapStruct背景在做网关系统API开发接口时，API实体有很多参数，因此UI设计为让用户分段保存API新建信息。在设计后端的时候，就需要分别接收前端传来的多段信息，分步保存到API信息数据表中。API实体参数很多，又需要多次转化实体，因此希望找到一个方便的实体转换机制，提升代码效率。于是就希望找到一个可以自动转换实体的工具，自然地就找到了MapStruct。 简介MapStruct是一">
<meta property="og:type" content="article">
<meta property="og:title" content="MapStruct大学习">
<meta property="og:url" content="https://wangruobei.github.io/2024/06/21/MapStruct%E5%A4%A7%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="Doudou&#39;s Blog">
<meta property="og:description" content="什么是MapStruct背景在做网关系统API开发接口时，API实体有很多参数，因此UI设计为让用户分段保存API新建信息。在设计后端的时候，就需要分别接收前端传来的多段信息，分步保存到API信息数据表中。API实体参数很多，又需要多次转化实体，因此希望找到一个方便的实体转换机制，提升代码效率。于是就希望找到一个可以自动转换实体的工具，自然地就找到了MapStruct。 简介MapStruct是一">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-06-21T05:22:56.000Z">
<meta property="article:modified_time" content="2024-06-26T12:13:53.451Z">
<meta property="article:author" content="DouDou">
<meta property="article:tag" content="MapStruct">
<meta property="article:tag" content="Spring Boot">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Doudou&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 7.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/sleep.png" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">DouDou</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/wangruobei" title="github">github</a>
					        
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/MapStruct/" style="font-size: 10px;">MapStruct</a> <a href="/tags/PMP/" style="font-size: 10px;">PMP</a> <a href="/tags/Spring-Boot/" style="font-size: 10px;">Spring Boot</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" style="font-size: 10px;">项目管理</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">间歇性热爱生活，新世纪农民工</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/sleep.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/wangruobei" title="github">github</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-MapStruct大学习" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/06/21/MapStruct%E5%A4%A7%E5%AD%A6%E4%B9%A0/" class="article-date">
  	<time datetime="2024-06-21T05:22:56.000Z" itemprop="datePublished">2024-06-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      MapStruct大学习
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MapStruct/" rel="tag">MapStruct</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/" rel="tag">Spring Boot</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- 目录内容 -->
        
            <p class="show-toc-btn" id="show-toc-btn" onclick="showToc();" style="display:none">
                <span class="btn-bg"></span>
                <span class="btn-text">文章导航</span>
            </p>
            <div id="toc-article" class="toc-article">
                <span id="toc-close" class="toc-close" title="隐藏导航" onclick="showBtn();">×</span>
                <strong class="toc-title">文章目录</strong>
                <!-- 修改生成目录项的代码片段，加入自定义类名 -->
                <ol class="custom-toc-item"><li class="custom-toc-item-item custom-toc-item-level-2"><a class="custom-toc-item-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFMapStruct"><span class="custom-toc-item-number">1.</span> <span class="custom-toc-item-text">什么是MapStruct</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#%E8%83%8C%E6%99%AF"><span class="custom-toc-item-number">1.1.</span> <span class="custom-toc-item-text">背景</span></a></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#%E7%AE%80%E4%BB%8B"><span class="custom-toc-item-number">1.2.</span> <span class="custom-toc-item-text">简介</span></a></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="custom-toc-item-number">1.3.</span> <span class="custom-toc-item-text">主要特性</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-2"><a class="custom-toc-item-link" href="#MapStruct%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="custom-toc-item-number">2.</span> <span class="custom-toc-item-text">MapStruct使用方法</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="custom-toc-item-number">2.1.</span> <span class="custom-toc-item-text">使用方法</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#1-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="custom-toc-item-number">2.1.1.</span> <span class="custom-toc-item-text">1. 添加依赖</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#2-%E5%AE%9A%E4%B9%89%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%92%8C-DTO"><span class="custom-toc-item-number">2.1.2.</span> <span class="custom-toc-item-text">2. 定义实体类和 DTO</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#3-%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84%E6%8E%A5%E5%8F%A3"><span class="custom-toc-item-number">2.1.3.</span> <span class="custom-toc-item-text">3. 定义映射接口</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#4-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84"><span class="custom-toc-item-number">2.1.4.</span> <span class="custom-toc-item-text">4. 自定义字段映射</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#5-%E5%BF%BD%E7%95%A5%E5%AD%97%E6%AE%B5"><span class="custom-toc-item-number">2.1.5.</span> <span class="custom-toc-item-text">5. 忽略字段</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#6-%E8%BF%90%E8%A1%8C%E6%98%A0%E5%B0%84"><span class="custom-toc-item-number">2.1.6.</span> <span class="custom-toc-item-text">6. 运行映射</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#7-%E6%98%A0%E5%B0%84%E5%B5%8C%E5%A5%97%E5%AF%B9%E8%B1%A1"><span class="custom-toc-item-number">2.1.7.</span> <span class="custom-toc-item-text">7. 映射嵌套对象</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#8-%E4%BD%BF%E7%94%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%88%96%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84"><span class="custom-toc-item-number">2.1.8.</span> <span class="custom-toc-item-text">8. 使用表达式或方法进行自定义映射</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#%E6%80%BB%E7%BB%93"><span class="custom-toc-item-number">2.1.9.</span> <span class="custom-toc-item-text">总结</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#%E6%B6%89%E5%8F%8A%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="custom-toc-item-number">2.2.</span> <span class="custom-toc-item-text">涉及的注解</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#1-Mapper"><span class="custom-toc-item-number">2.2.1.</span> <span class="custom-toc-item-text">1. @Mapper</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#2-Mapping"><span class="custom-toc-item-number">2.2.2.</span> <span class="custom-toc-item-text">2. @Mapping</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#3-Mappings"><span class="custom-toc-item-number">2.2.3.</span> <span class="custom-toc-item-text">3. @Mappings</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#4-MappingTarget"><span class="custom-toc-item-number">2.2.4.</span> <span class="custom-toc-item-text">4. @MappingTarget</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#5-InheritConfiguration"><span class="custom-toc-item-number">2.2.5.</span> <span class="custom-toc-item-text">5. @InheritConfiguration</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#6-InheritInverseConfiguration"><span class="custom-toc-item-number">2.2.6.</span> <span class="custom-toc-item-text">6. @InheritInverseConfiguration</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#7-BeanMapping"><span class="custom-toc-item-number">2.2.7.</span> <span class="custom-toc-item-text">7. @BeanMapping</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#8-IterableMapping"><span class="custom-toc-item-number">2.2.8.</span> <span class="custom-toc-item-text">8. @IterableMapping</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#9-MapMapping"><span class="custom-toc-item-number">2.2.9.</span> <span class="custom-toc-item-text">9. @MapMapping</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#10-ValueMapping"><span class="custom-toc-item-number">2.2.10.</span> <span class="custom-toc-item-text">10. @ValueMapping</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#11-MapperConfig"><span class="custom-toc-item-number">2.2.11.</span> <span class="custom-toc-item-text">11. @MapperConfig</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#Mapper%E6%B3%A8%E8%A7%A3%E7%9A%84%E7%94%A8%E6%B3%95"><span class="custom-toc-item-number">2.3.</span> <span class="custom-toc-item-text">@Mapper注解的用法</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#1-componentModel"><span class="custom-toc-item-number">2.3.1.</span> <span class="custom-toc-item-text">1. componentModel</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#2-uses"><span class="custom-toc-item-number">2.3.2.</span> <span class="custom-toc-item-text">2. uses</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#3-unmappedTargetPolicy"><span class="custom-toc-item-number">2.3.3.</span> <span class="custom-toc-item-text">3. unmappedTargetPolicy</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#4-implementationName"><span class="custom-toc-item-number">2.3.4.</span> <span class="custom-toc-item-text">4. implementationName</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#5-implementationPackage"><span class="custom-toc-item-number">2.3.5.</span> <span class="custom-toc-item-text">5. implementationPackage</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#6-config"><span class="custom-toc-item-number">2.3.6.</span> <span class="custom-toc-item-text">6. config</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#7-nullValueMappingStrategy"><span class="custom-toc-item-number">2.3.7.</span> <span class="custom-toc-item-text">7. nullValueMappingStrategy</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#8-mappingInheritanceStrategy"><span class="custom-toc-item-number">2.3.8.</span> <span class="custom-toc-item-text">8. mappingInheritanceStrategy</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#9-collectionMappingStrategy"><span class="custom-toc-item-number">2.3.9.</span> <span class="custom-toc-item-text">9. collectionMappingStrategy</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#%E6%80%BB%E7%BB%93-1"><span class="custom-toc-item-number">2.3.10.</span> <span class="custom-toc-item-text">总结</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#Mapping%E7%9A%84%E7%94%A8%E6%B3%95"><span class="custom-toc-item-number">2.4.</span> <span class="custom-toc-item-text">@Mapping的用法</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#1-source"><span class="custom-toc-item-number">2.4.1.</span> <span class="custom-toc-item-text">1. source</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#2-target"><span class="custom-toc-item-number">2.4.2.</span> <span class="custom-toc-item-text">2. target</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#3-ignore"><span class="custom-toc-item-number">2.4.3.</span> <span class="custom-toc-item-text">3. ignore</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#4-dateFormat"><span class="custom-toc-item-number">2.4.4.</span> <span class="custom-toc-item-text">4. dateFormat</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#5-numberFormat"><span class="custom-toc-item-number">2.4.5.</span> <span class="custom-toc-item-text">5. numberFormat</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#6-constant"><span class="custom-toc-item-number">2.4.6.</span> <span class="custom-toc-item-text">6. constant</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#7-expression"><span class="custom-toc-item-number">2.4.7.</span> <span class="custom-toc-item-text">7. expression</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#8-defaultValue"><span class="custom-toc-item-number">2.4.8.</span> <span class="custom-toc-item-text">8. defaultValue</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#9-defaultExpression"><span class="custom-toc-item-number">2.4.9.</span> <span class="custom-toc-item-text">9. defaultExpression</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#10-qualifiedByName-%E5%92%8C-qualifiedBy"><span class="custom-toc-item-number">2.4.10.</span> <span class="custom-toc-item-text">10. qualifiedByName 和 qualifiedBy</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#11-resultType"><span class="custom-toc-item-number">2.4.11.</span> <span class="custom-toc-item-text">11. resultType</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#12-dependsOn"><span class="custom-toc-item-number">2.4.12.</span> <span class="custom-toc-item-text">12. dependsOn</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#13-mapNullToDefault"><span class="custom-toc-item-number">2.4.13.</span> <span class="custom-toc-item-text">13. mapNullToDefault</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E7%BB%BC%E5%90%88%E8%BF%90%E7%94%A8%E8%BF%99%E4%BA%9B%E9%85%8D%E7%BD%AE"><span class="custom-toc-item-number">2.4.14.</span> <span class="custom-toc-item-text">示例：综合运用这些配置</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#%E6%80%BB%E7%BB%93-2"><span class="custom-toc-item-number">2.4.15.</span> <span class="custom-toc-item-text">总结</span></a></li></ol></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-2"><a class="custom-toc-item-link" href="#MapStruct%E7%9A%84%E6%9C%BA%E5%88%B6"><span class="custom-toc-item-number">3.</span> <span class="custom-toc-item-text">MapStruct的机制</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#1-%E7%BC%96%E8%AF%91%E6%97%B6%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="custom-toc-item-number">3.1.</span> <span class="custom-toc-item-text">1. 编译时代码生成</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#%E7%BC%96%E8%AF%91%E6%97%B6%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8"><span class="custom-toc-item-number">3.1.1.</span> <span class="custom-toc-item-text">编译时注解处理器</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#2-%E4%B8%8E-Spring-Boot-%E9%9B%86%E6%88%90"><span class="custom-toc-item-number">3.2.</span> <span class="custom-toc-item-text">2. 与 Spring Boot 集成</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="custom-toc-item-number">3.2.1.</span> <span class="custom-toc-item-text">配置示例</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="custom-toc-item-number">3.2.2.</span> <span class="custom-toc-item-text">使用示例</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#3-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E6%9C%BA%E5%88%B6"><span class="custom-toc-item-number">3.3.</span> <span class="custom-toc-item-text">3. 注解处理器的详细机制</span></a></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#4-Spring-Boot-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="custom-toc-item-number">3.4.</span> <span class="custom-toc-item-text">4. Spring Boot 自动配置</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="custom-toc-item-number">3.4.1.</span> <span class="custom-toc-item-text">自动配置示例</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#%E6%80%BB%E7%BB%93-3"><span class="custom-toc-item-number">3.5.</span> <span class="custom-toc-item-text">总结</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-2"><a class="custom-toc-item-link" href="#MapStruct%E8%BE%A8%E6%9E%90"><span class="custom-toc-item-number">4.</span> <span class="custom-toc-item-text">MapStruct辨析</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#ModelMapper"><span class="custom-toc-item-number">4.1.</span> <span class="custom-toc-item-text">ModelMapper</span></a></li></ol></li><li class="custom-toc-item-item custom-toc-item-level-2"><a class="custom-toc-item-link" href="#MapStruct%E8%B8%A9%E5%9D%91"><span class="custom-toc-item-number">5.</span> <span class="custom-toc-item-text">MapStruct踩坑</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-3"><a class="custom-toc-item-link" href="#%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%98%E7%9A%84%E6%A0%B9%E5%9B%A0"><span class="custom-toc-item-number">5.1.</span> <span class="custom-toc-item-text">顺序问题的根因</span></a><ol class="custom-toc-item-child"><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#1-Lombok-%E7%9A%84%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="custom-toc-item-number">5.1.1.</span> <span class="custom-toc-item-text">1. Lombok 的代码生成</span></a></li><li class="custom-toc-item-item custom-toc-item-level-4"><a class="custom-toc-item-link" href="#2-MapStruct-%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="custom-toc-item-number">5.1.2.</span> <span class="custom-toc-item-text">2. MapStruct 的依赖</span></a></li></ol></li></ol></li></ol>
            </div>
            <script type="text/javascript">
                function showToc(){
                    var toc_article = document.getElementById("toc-article");
                    var show_toc_btn = document.getElementById("show-toc-btn");
                    toc_article.setAttribute("style","display:block");
                    show_toc_btn.setAttribute("style","display:none");
                };
                function showBtn(){
                    var toc_article = document.getElementById("toc-article");
                    var show_toc_btn = document.getElementById("show-toc-btn");
                    toc_article.setAttribute("style","display:none");
                    show_toc_btn.setAttribute("style","display:block");
                };
            </script>
        
        <!-- 目录内容结束 -->
        <h2 id="什么是MapStruct"><a href="#什么是MapStruct" class="headerlink" title="什么是MapStruct"></a>什么是MapStruct</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在做网关系统API开发接口时，API实体有很多参数，因此UI设计为让用户分段保存API新建信息。在设计后端的时候，就需要分别接收前端传来的多段信息，分步保存到API信息数据表中。API实体参数很多，又需要多次转化实体，因此希望找到一个方便的实体转换机制，提升代码效率。于是就希望找到一个可以自动转换实体的工具，自然地就找到了MapStruct。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>MapStruct是一个属性映射工具，用于简化对象之间的映射（mapping）。它通过注解处理器在编译时生成类型安全、高性能的映射代码，从而避免了手动编写重复且易出错的映射逻辑。</p>
<h3 id="主要特性"><a href="#主要特性" class="headerlink" title="主要特性"></a>主要特性</h3><ol>
<li><p><strong>编译时生成代码</strong>：</p>
<ul>
<li>MapStruct 在编译时生成映射代码，因此可以捕捉到映射过程中可能出现的问题，这提供了更高的安全性和性能。</li>
</ul>
</li>
<li><p><strong>高性能</strong>：</p>
<ul>
<li>由于生成的代码是纯 Java 代码，没有任何反射调用，运行时性能非常高。</li>
</ul>
</li>
<li><p><strong>简单易用</strong>：</p>
<ul>
<li>使用注解来定义映射关系，简单直观。例如，<code>@Mapper</code> 注解用于定义一个映射接口。</li>
</ul>
</li>
<li><p><strong>支持多种类型转换</strong>：</p>
<ul>
<li>支持复杂类型的转换，包括集合、映射、以及自定义类型转换。</li>
</ul>
</li>
<li><p><strong>保证类型安全</strong></p>
<p>通过编译时生成代码，MapStruct 能够在编译期间捕捉到一些潜在的映射问题，如类型不匹配、字段缺失等，这大大提高了安全性。</p>
</li>
<li><p><strong>集成其他框架</strong></p>
<p>MapStruct 可以很容易地与 Spring、CDI 等依赖注入框架集成，使得映射器可以作为 Bean 被注入使用。</p>
</li>
</ol>
<h2 id="MapStruct使用方法"><a href="#MapStruct使用方法" class="headerlink" title="MapStruct使用方法"></a>MapStruct使用方法</h2><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>MapStruct 是一个代码生成库，通过注解在编译时生成对象映射代码。它的使用方法非常直观，主要通过定义映射接口和相关注解来完成。下面是一个详细的指南，展示如何在项目中使用 MapStruct。</p>
<h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><p>首先，需要在项目中添加 MapStruct 的依赖。这里以 Maven 为例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 请根据需要选择具体版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于 Gradle，可以这样添加依赖：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.mapstruct:mapstruct:1.4.2.Final&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;org.mapstruct:mapstruct-processor:1.4.2.Final&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-定义实体类和-DTO"><a href="#2-定义实体类和-DTO" class="headerlink" title="2. 定义实体类和 DTO"></a>2. 定义实体类和 DTO</h4><p>假设我们有一个 <code>User</code> 实体和对应的 <code>UserDTO</code> 数据传输对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-定义映射接口"><a href="#3-定义映射接口" class="headerlink" title="3. 定义映射接口"></a>3. 定义映射接口</h4><p>接下来，定义一个映射器接口，用于将 <code>User</code> 转换为 <code>UserDTO</code> 或者反过来转换。使用 <code>@Mapper</code> 注解来标记这个接口。以下是最简单的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-自定义字段映射"><a href="#4-自定义字段映射" class="headerlink" title="4. 自定义字段映射"></a>4. 自定义字段映射</h4><p>如果字段名不一致，可以使用 <code>@Mapping</code> 注解进行自定义映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String emailAddress; <span class="comment">// 和 UserDTO 不同的字段名</span></span><br><span class="line">    <span class="keyword">private</span> String contactNumber; <span class="comment">// 和 UserDTO 不同的字段名</span></span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;contactNumber&quot;, target = &quot;phoneNumber&quot;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;email&quot;, target = &quot;emailAddress&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;phoneNumber&quot;, target = &quot;contactNumber&quot;)</span></span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-忽略字段"><a href="#5-忽略字段" class="headerlink" title="5. 忽略字段"></a>5. 忽略字段</h4><p>某些字段不需要映射时，可以使用 <code>ignore</code> 属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String password; <span class="comment">// 不希望在 DTO 中暴露</span></span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-运行映射"><a href="#6-运行映射" class="headerlink" title="6. 运行映射"></a>6. 运行映射</h4><p>在服务层或控制器中使用映射器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">convertToDTO</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UserMapper.INSTANCE.userToUserDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">convertToEntity</span><span class="params">(UserDTO dto)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UserMapper.INSTANCE.userDTOToUser(dto);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-映射嵌套对象"><a href="#7-映射嵌套对象" class="headerlink" title="7. 映射嵌套对象"></a>7. 映射嵌套对象</h4><p>如果实体类中包含嵌套对象，也可以进行映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String zipCode;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String zipCode;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> AddressDTO address;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-使用表达式或方法进行自定义映射"><a href="#8-使用表达式或方法进行自定义映射" class="headerlink" title="8. 使用表达式或方法进行自定义映射"></a>8. 使用表达式或方法进行自定义映射</h4><p>可以使用 <code>expression</code> 或自定义方法来进行复杂映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(source = &quot;firstName&quot;, target = &quot;name&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;age&quot;, target = &quot;years&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;fullName&quot;, expression = &quot;java(user.getFirstName() + \&quot; \&quot; + user.getLastName())&quot;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mapping(source = &quot;name&quot;, target = &quot;firstName&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;lastName&quot;, ignore = true)</span></span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">mapString</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>MapStruct 是一个功能强大的工具，通过注解生成类型安全、高性能的对象映射代码。它的配置简单、直观，支持多种高级特性，例如嵌套映射、自定义字段映射、忽略字段等。使用 MapStruct 可以大大减少手动编写映射代码的繁琐工作，提高代码的可读性和维护性。</p>
<h3 id="涉及的注解"><a href="#涉及的注解" class="headerlink" title="涉及的注解"></a>涉及的注解</h3><p>MapStruct 提供了一系列注解来支持对象映射，包括但不限于 <code>@Mapper</code>、<code>@Mapping</code>、<code>@InheritConfiguration</code> 和 <code>@InheritInverseConfiguration</code> 等。这些注解允许开发者细粒度地控制对象映射过程。下面是常用 MapStruct 注解的详细介绍及其使用示例：</p>
<h4 id="1-Mapper"><a href="#1-Mapper" class="headerlink" title="1. @Mapper"></a>1. @Mapper</h4><p><code>@Mapper</code> 是定义映射接口的核心注解，用于标记一个接口为映射器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-Mapping"><a href="#2-Mapping" class="headerlink" title="2. @Mapping"></a>2. @Mapping</h4><p><code>@Mapping</code> 用于自定义字段映射，主要用于字段名不匹配的情况，也可以用于设置常量值、表达式等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;contactNumber&quot;, target = &quot;phoneNumber&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;fullName&quot;, expression = &quot;java(user.getFirstName() + &#x27; &#x27; + user.getLastName())&quot;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;email&quot;, target = &quot;emailAddress&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;phoneNumber&quot;, target = &quot;contactNumber&quot;)</span></span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-Mappings"><a href="#3-Mappings" class="headerlink" title="3. @Mappings"></a>3. @Mappings</h4><p><code>@Mappings</code> 是 <code>@Mapping</code> 的容器，方便在一个方法上应用多个 <code>@Mapping</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mappings(&#123;</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;contactNumber&quot;, target = &quot;phoneNumber&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mappings(&#123;</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;email&quot;, target = &quot;emailAddress&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;phoneNumber&quot;, target = &quot;contactNumber&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-MappingTarget"><a href="#4-MappingTarget" class="headerlink" title="4. @MappingTarget"></a>4. @MappingTarget</h4><p><code>@MappingTarget</code> 用于指定目标参数，通常用于部分更新或现有对象的映射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateUserFromDTO</span><span class="params">(UserDTO dto, <span class="meta">@MappingTarget</span> User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-InheritConfiguration"><a href="#5-InheritConfiguration" class="headerlink" title="5. @InheritConfiguration"></a>5. @InheritConfiguration</h4><p><code>@InheritConfiguration</code> 用于继承其他方法的映射配置，常用于简化类似方法的配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;contactNumber&quot;, target = &quot;phoneNumber&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateUserFromDTO</span><span class="params">(UserDTO dto, <span class="meta">@MappingTarget</span> User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InheritConfiguration(name = &quot;updateUserFromDTO&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateAnotherUserFromDTO</span><span class="params">(UserDTO dto, <span class="meta">@MappingTarget</span> User anotherUser)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-InheritInverseConfiguration"><a href="#6-InheritInverseConfiguration" class="headerlink" title="6. @InheritInverseConfiguration"></a>6. @InheritInverseConfiguration</h4><p><code>@InheritInverseConfiguration</code> 用于自动生成反向映射配置，减少重复代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;contactNumber&quot;, target = &quot;phoneNumber&quot;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InheritInverseConfiguration</span></span><br><span class="line">    User <span class="title function_">userDTOToUser</span><span class="params">(UserDTO dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-BeanMapping"><a href="#7-BeanMapping" class="headerlink" title="7. @BeanMapping"></a>7. @BeanMapping</h4><p><code>@BeanMapping</code> 用于控制复杂的映射行为，例如忽略未映射的属性、指定映射策略等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@BeanMapping(ignoreByDefault = true)</span></span><br><span class="line">    <span class="meta">@Mappings(&#123;</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;contactNumber&quot;, target = &quot;phoneNumber&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-IterableMapping"><a href="#8-IterableMapping" class="headerlink" title="8. @IterableMapping"></a>8. @IterableMapping</h4><p><code>@IterableMapping</code> 用于处理集合类型的映射，指定元素的映射规则。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@IterableMapping(elementTargetType = UserDTO.class)</span></span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">usersToUserDTOs</span><span class="params">(List&lt;User&gt; users)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-MapMapping"><a href="#9-MapMapping" class="headerlink" title="9. @MapMapping"></a>9. @MapMapping</h4><p><code>@MapMapping</code> 用于处理 Map 类型的映射，指定键值对的映射规则。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@MapMapping(keyTargetType = String.class, valueTargetType = UserDTO.class)</span></span><br><span class="line">    Map&lt;String, UserDTO&gt; <span class="title function_">usersToUserDTOs</span><span class="params">(Map&lt;String, User&gt; users)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-ValueMapping"><a href="#10-ValueMapping" class="headerlink" title="10. @ValueMapping"></a>10. @ValueMapping</h4><p><code>@ValueMapping</code> 用于处理枚举类型的映射，指定枚举值之间的映射关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UserStatus</span> &#123;</span><br><span class="line">    ACTIVE, INACTIVE, DELETED</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UserStatusDTO</span> &#123;</span><br><span class="line">    ACTIVE, INACTIVE, REMOVED</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserStatusMapper</span> &#123;</span><br><span class="line">    <span class="meta">@ValueMapping(source = &quot;DELETED&quot;, target = &quot;REMOVED&quot;)</span></span><br><span class="line">    UserStatusDTO <span class="title function_">userStatusToUserStatusDTO</span><span class="params">(UserStatus status)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="11-MapperConfig"><a href="#11-MapperConfig" class="headerlink" title="11. @MapperConfig"></a>11. @MapperConfig</h4><p><code>@MapperConfig</code> 用于定义可复用的映射配置，多个映射器可以共享这些配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperConfig</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CentralConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(target = &quot;id&quot;, ignore = true)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper(config = CentralConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mapper注解的用法"><a href="#Mapper注解的用法" class="headerlink" title="@Mapper注解的用法"></a>@Mapper注解的用法</h3><p>在 <code>@Mapper</code> 注解中，可以使用多种参数来定制映射策略。这些参数可以帮助你控制映射的生成方式、组件模型、命名约定等。以下是一些常用的参数及其功能：</p>
<h4 id="1-componentModel"><a href="#1-componentModel" class="headerlink" title="1. componentModel"></a>1. componentModel</h4><p><code>componentModel</code> 参数用于指定生成映射器实现类的组件模型。常见的值包括：</p>
<ul>
<li><strong>default</strong>: 默认值，不使用任何依赖注入框架。</li>
<li><strong>spring</strong>: 使用 Spring 的依赖注入。</li>
<li><strong>cdi</strong>: 使用 CDI（Contexts and Dependency Injection）依赖注入。</li>
<li><strong>jsr330</strong>: 使用 JSR 330 标准的 <code>@Inject</code> 注解进行依赖注入。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(componentModel = &quot;spring&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-uses"><a href="#2-uses" class="headerlink" title="2. uses"></a>2. uses</h4><p><code>uses</code> 参数用于指定其他映射器或类型转换器，这些辅助映射器可以在当前映射器中调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(uses = &#123; AddressMapper.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-unmappedTargetPolicy"><a href="#3-unmappedTargetPolicy" class="headerlink" title="3. unmappedTargetPolicy"></a>3. unmappedTargetPolicy</h4><p><code>unmappedTargetPolicy</code> 参数用于指定处理未映射目标属性的策略。可选值有：</p>
<ul>
<li><strong>IGNORE</strong>: 忽略未映射的目标属性。</li>
<li><strong>WARN</strong>: 记录未映射的目标属性警告。</li>
<li><strong>ERROR</strong>: 抛出异常，强制所有目标属性必须映射。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(unmappedTargetPolicy = ReportingPolicy.WARN)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-implementationName"><a href="#4-implementationName" class="headerlink" title="4. implementationName"></a>4. implementationName</h4><p><code>implementationName</code> 参数用于自定义生成的实现类名称。默认情况下，MapStruct 会将接口名后加上 <code>Impl</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(implementationName = &quot;CustomUserMapperImpl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-implementationPackage"><a href="#5-implementationPackage" class="headerlink" title="5. implementationPackage"></a>5. implementationPackage</h4><p><code>implementationPackage</code> 参数用于指定生成的实现类的包名。默认情况下，生成的实现类会和接口放在同一个包下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(implementationPackage = &quot;com.example.mapper.impl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-config"><a href="#6-config" class="headerlink" title="6. config"></a>6. config</h4><p><code>config</code> 参数用于指定配置类，这个配置类可以包含通用的映射方法或配置，以便多个映射器共享。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperConfig</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CentralConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(target = &quot;id&quot;, ignore = true)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper(config = CentralConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-nullValueMappingStrategy"><a href="#7-nullValueMappingStrategy" class="headerlink" title="7. nullValueMappingStrategy"></a>7. nullValueMappingStrategy</h4><p><code>nullValueMappingStrategy</code> 参数用于指定当源对象为 <code>null</code> 时的策略。可选值有：</p>
<ul>
<li><strong>RETURN_DEFAULT</strong>: 返回默认值，如空集合或零值。</li>
<li><strong>RETURN_NULL</strong>: 返回 <code>null</code>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(nullValueMappingStrategy = NullValueMappingStrategy.RETURN_DEFAULT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-mappingInheritanceStrategy"><a href="#8-mappingInheritanceStrategy" class="headerlink" title="8. mappingInheritanceStrategy"></a>8. mappingInheritanceStrategy</h4><p><code>mappingInheritanceStrategy</code> 参数用于指定映射继承策略。可选值有：</p>
<ul>
<li><strong>EXPLICIT</strong>: 需要显式地标记 <code>@InheritConfiguration</code> 或 <code>@InheritInverseConfiguration</code>。</li>
<li><strong>AUTO_INHERIT_FROM_CONFIG</strong>: 自动从配置类继承映射配置。</li>
<li><strong>AUTO_INHERIT_ALL_FROM_CONFIG</strong>: 自动从配置类继承所有映射配置。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(mappingInheritanceStrategy = MappingInheritanceStrategy.AUTO_INHERIT_FROM_CONFIG)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-collectionMappingStrategy"><a href="#9-collectionMappingStrategy" class="headerlink" title="9. collectionMappingStrategy"></a>9. collectionMappingStrategy</h4><p><code>collectionMappingStrategy</code> 参数用于指定集合类型的映射策略。可选值有：</p>
<ul>
<li><strong>ACCESSOR_ONLY</strong>: 仅通过访问器（getter&#x2F;setter）进行映射。</li>
<li><strong>ADDERS</strong>: 使用添加者方法（如 <code>add</code>）。</li>
<li><strong>TARGET_IMMUTABLE</strong>: 目标集合不可变，需要新集合实例。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(collectionMappingStrategy = CollectionMappingStrategy.ADDER_PREFERRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>MapStruct 提供了丰富的参数选项，可以在 <code>@Mapper</code> 注解中进行配置，以满足不同的映射需求。通过这些参数，可以充分控制映射器的生成方式、组件模型、错误处理策略、集合映射策略等，从而使映射过程更加灵活和高效。</p>
<h3 id="Mapping的用法"><a href="#Mapping的用法" class="headerlink" title="@Mapping的用法"></a>@Mapping的用法</h3><p><code>@Mapping</code> 注解在 MapStruct 中是非常强大的工具，它允许你细粒度地控制对象属性的映射。以下是 <code>@Mapping</code> 注解的各种配置选项及其用法：</p>
<h4 id="1-source"><a href="#1-source" class="headerlink" title="1. source"></a>1. source</h4><p><code>source</code> 属性指定源对象中的字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="2-target"><a href="#2-target" class="headerlink" title="2. target"></a>2. target</h4><p><code>target</code> 属性指定目标对象中的字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="3-ignore"><a href="#3-ignore" class="headerlink" title="3. ignore"></a>3. ignore</h4><p><code>ignore</code> 属性用于忽略特定字段的映射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(target = &quot;password&quot;, ignore = true)</span></span><br></pre></td></tr></table></figure>

<h4 id="4-dateFormat"><a href="#4-dateFormat" class="headerlink" title="4. dateFormat"></a>4. dateFormat</h4><p><code>dateFormat</code> 属性用于日期格式的转换，使用标准的 Java 日期格式字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(source = &quot;birthDate&quot;, target = &quot;birthDate&quot;, dateFormat = &quot;yyyy-MM-dd&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="5-numberFormat"><a href="#5-numberFormat" class="headerlink" title="5. numberFormat"></a>5. numberFormat</h4><p><code>numberFormat</code> 属性用于数字格式的转换，使用标准的 Java 数字格式字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(source = &quot;salary&quot;, target = &quot;formattedSalary&quot;, numberFormat = &quot;#,###.00&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="6-constant"><a href="#6-constant" class="headerlink" title="6. constant"></a>6. constant</h4><p><code>constant</code> 属性用于设置目标字段的常量值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(target = &quot;type&quot;, constant = &quot;USER&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="7-expression"><a href="#7-expression" class="headerlink" title="7. expression"></a>7. expression</h4><p><code>expression</code> 属性用于使用 Java 表达式自定义映射逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(target = &quot;fullName&quot;, expression = &quot;java(user.getFirstName() + &#x27; &#x27; + user.getLastName())&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="8-defaultValue"><a href="#8-defaultValue" class="headerlink" title="8. defaultValue"></a>8. defaultValue</h4><p><code>defaultValue</code> 属性用于设置当源字段为 null 时，目标字段的默认值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(target = &quot;status&quot;, defaultValue = &quot;ACTIVE&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="9-defaultExpression"><a href="#9-defaultExpression" class="headerlink" title="9. defaultExpression"></a>9. defaultExpression</h4><p><code>defaultExpression</code> 属性用于当源字段为 null 时，通过表达式设置目标字段的默认值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(target = &quot;auditInfo&quot;, defaultExpression = &quot;java(new java.util.Date())&quot;)</span></span><br></pre></td></tr></table></figure>

<h4 id="10-qualifiedByName-和-qualifiedBy"><a href="#10-qualifiedByName-和-qualifiedBy" class="headerlink" title="10. qualifiedByName 和 qualifiedBy"></a>10. qualifiedByName 和 qualifiedBy</h4><p><code>qualifiedByName</code> 和 <code>qualifiedBy</code> 用于指定自定义类型转换方法。这通常与 <code>@Named</code> 注解一起使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;birthdate&quot;, target = &quot;birthdate&quot;, qualifiedByName = &quot;dateToString&quot;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(&quot;dateToString&quot;)</span></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">dateToString</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>).format(date);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="11-resultType"><a href="#11-resultType" class="headerlink" title="11. resultType"></a>11. resultType</h4><p><code>resultType</code> 属性用于指定返回类型，通常用于泛型和集合映射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;users&quot;, target = &quot;userDTOs&quot;, resultType = ArrayList.class)</span></span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">usersToUserDTOs</span><span class="params">(List&lt;User&gt; users)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-dependsOn"><a href="#12-dependsOn" class="headerlink" title="12. dependsOn"></a>12. dependsOn</h4><p><code>dependsOn</code> 属性用于指定当前映射依赖的其他映射。这个属性有助于处理复杂的多步骤映射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mappings(&#123;</span></span><br><span class="line"><span class="meta">        @Mapping(target = &quot;addressLine&quot;, source = &quot;address.line&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(target = &quot;city&quot;, source = &quot;address.city&quot;, dependsOn = &quot;addressLine&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="13-mapNullToDefault"><a href="#13-mapNullToDefault" class="headerlink" title="13. mapNullToDefault"></a>13. mapNullToDefault</h4><p><code>mapNullToDefault</code> 属性用于将 null 值映射到目标对象的默认值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;name&quot;, source = &quot;name&quot;, mapNullToDefault = true)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="示例：综合运用这些配置"><a href="#示例：综合运用这些配置" class="headerlink" title="示例：综合运用这些配置"></a>示例：综合运用这些配置</h4><p>这里展示一个综合运用多种 <code>@Mapping</code> 配置的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Date birthdate;</span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line">    <span class="keyword">private</span> String emailAddress;</span><br><span class="line">    <span class="keyword">private</span> String contactNumber;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line">    <span class="keyword">private</span> String birthDateString;</span><br><span class="line">    <span class="keyword">private</span> String formattedSalary;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="keyword">private</span> Date auditInfo;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mappings(&#123;</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;firstName&quot;, target = &quot;fullName&quot;, expression = &quot;java(user.getFirstName() + \&quot; \&quot; + user.getLastName())&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;birthdate&quot;, target = &quot;birthDateString&quot;, dateFormat = &quot;yyyy-MM-dd&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;salary&quot;, target = &quot;formattedSalary&quot;, numberFormat = &quot;#,###.00&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;emailAddress&quot;, target = &quot;email&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(source = &quot;contactNumber&quot;, target = &quot;phoneNumber&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(target = &quot;type&quot;, constant = &quot;USER&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(target = &quot;status&quot;, defaultValue = &quot;ACTIVE&quot;),</span></span><br><span class="line"><span class="meta">        @Mapping(target = &quot;auditInfo&quot;, defaultExpression = &quot;java(new java.util.Date())&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><p>MapStruct 的 <code>@Mapping</code> 注解提供了丰富的配置选项，可以满足大多数对象映射需求。通过合理使用这些配置，你可以大大简化数据传输对象（DTO）和实体类之间的映射逻辑，提高代码的可维护性和性能。</p>
<h2 id="MapStruct的机制"><a href="#MapStruct的机制" class="headerlink" title="MapStruct的机制"></a>MapStruct的机制</h2><p>要解释 MapStruct 在 Spring Boot 中的工作原理，我们需要从几个方面来理解其背后的机制，包括编译时代码生成、注解处理器（Annotation Processor）、以及如何与 Spring Boot 一起使用。</p>
<h3 id="1-编译时代码生成"><a href="#1-编译时代码生成" class="headerlink" title="1. 编译时代码生成"></a>1. 编译时代码生成</h3><p>MapStruct 的核心机制是编译时代码生成。它通过注解处理器在编译期间扫描和处理 <code>@Mapper</code> 注解，然后生成对应的实现类。这个过程不依赖于运行时反射，因此具有高性能和类型安全性。</p>
<h4 id="编译时注解处理器"><a href="#编译时注解处理器" class="headerlink" title="编译时注解处理器"></a>编译时注解处理器</h4><p>Java 编译器支持注解处理器，这些处理器可以在编译时处理特定的注解并生成相应的代码。MapStruct 就是利用这一机制，通过处理 <code>@Mapper</code> 等注解生成映射器实现类。</p>
<p><strong>工作流程</strong>：</p>
<ul>
<li><strong>定义映射接口</strong>：开发者定义一个带有 <code>@Mapper</code> 注解的接口。</li>
<li><strong>编译时扫描</strong>：编译器在编译过程中扫描到 <code>@Mapper</code> 注解，并调用 MapStruct 的注解处理器。</li>
<li><strong>生成代码</strong>：MapStruct 的注解处理器读取映射接口的信息，生成相应的实现类并将其放在编译输出目录中。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译时，MapStruct 会生成类似如下的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( user == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        userDTO.setFirstName( user.getFirstName() );</span><br><span class="line">        userDTO.setLastName( user.getLastName() );</span><br><span class="line">        <span class="comment">// 其他字段映射...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userDTO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-与-Spring-Boot-集成"><a href="#2-与-Spring-Boot-集成" class="headerlink" title="2. 与 Spring Boot 集成"></a>2. 与 Spring Boot 集成</h3><p>为了在 Spring Boot 中使用 MapStruct，通常需要指定 <code>componentModel = &quot;spring&quot;</code>。这会让 MapStruct 生成的映射器实现类作为 Spring Bean 注册，从而可以通过依赖注入获取。</p>
<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(componentModel = &quot;spring&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">userToUserDTO</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样生成的实现类会被标记为 Spring 的 <code>@Component</code>，并且会自动注册到 Spring 上下文中。</p>
<h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserMapper userMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">convertToDTO</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.userToUserDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 Spring Boot 应用中，上述配置确保了 <code>UserMapper</code> 作为一个 Spring Bean 被注入到 <code>UserService</code> 中。</p>
<h3 id="3-注解处理器的详细机制"><a href="#3-注解处理器的详细机制" class="headerlink" title="3. 注解处理器的详细机制"></a>3. 注解处理器的详细机制</h3><p>MapStruct 的注解处理器是在 <code>META-INF/services/javax.annotation.processing.Processor</code> 文件中声明的。这使得 Java 编译器能够找到并执行这个处理器。</p>
<p>具体步骤如下：</p>
<ol>
<li><strong>查找处理器</strong>：编译器扫描 <code>META-INF/services/javax.annotation.processing.Processor</code> 文件，找到 MapStruct 声明的处理器类名。</li>
<li><strong>加载处理器</strong>：编译器加载并实例化这个处理器。</li>
<li><strong>处理注解</strong>：当编译器发现被 <code>@Mapper</code> 注解修饰的接口时，它会调用 MapStruct 的处理器来生成相应的实现类。</li>
</ol>
<h3 id="4-Spring-Boot-自动配置"><a href="#4-Spring-Boot-自动配置" class="headerlink" title="4. Spring Boot 自动配置"></a>4. Spring Boot 自动配置</h3><p>Spring Boot 使用自动配置来简化许多设置，这同样适用于集成 MapStruct。通过指定 <code>componentModel = &quot;spring&quot;</code>，MapStruct 生成的实现类会自动成为 Spring 上下文中的 Bean，而不需要额外的配置。</p>
<h4 id="自动配置示例"><a href="#自动配置示例" class="headerlink" title="自动配置示例"></a>自动配置示例</h4><p>Spring Boot 的自动配置机制通过 <code>spring.factories</code> 文件或者 <code>@Configuration</code> 类来实现。当你在 <code>@SpringBootApplication</code> 类上添加了 <code>@EnableAutoConfiguration</code> 或者默认启用自动配置时，Spring Boot 会自动扫描所有依赖库中的这些配置文件并应用相应的配置。</p>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p>MapStruct 的工作原理主要基于编译时注解处理器，它在编译期间生成高效、类型安全的映射代码。通过与 Spring Boot 的集成，开发者可以轻松地将这些映射器作为 Spring Bean 使用，从而享受 Spring 框架提供的各种依赖注入功能。</p>
<p>这一机制保证了 MapStruct 映射器的高效性，同时也利用了 Spring Boot 的自动配置和依赖注入，极大地简化了开发过程，提高了代码的可维护性和可读性。</p>
<h2 id="MapStruct辨析"><a href="#MapStruct辨析" class="headerlink" title="MapStruct辨析"></a>MapStruct辨析</h2><h3 id="ModelMapper"><a href="#ModelMapper" class="headerlink" title="ModelMapper"></a>ModelMapper</h3><ul>
<li><strong>实现方式</strong>：<ul>
<li><strong>MapStruct</strong>：编译时生成代码，无运行时开销。</li>
<li><strong>ModelMapper</strong>：运行时生成映射逻辑，使用反射，灵活但性能较差。</li>
</ul>
</li>
<li><strong>性能</strong>：<ul>
<li><strong>MapStruct</strong>：高性能，没有运行时反射开销。</li>
<li><strong>ModelMapper</strong>：由于使用反射，性能较差，在大量对象映射或频繁调用时影响明显。</li>
</ul>
</li>
<li><strong>配置和使用</strong>：<ul>
<li><strong>MapStruct</strong>：注解驱动，配置简单直观。</li>
<li><strong>ModelMapper</strong>：API 驱动，支持动态配置和更复杂的映射规则，但学习曲线较陡。</li>
</ul>
</li>
</ul>
<h2 id="MapStruct踩坑"><a href="#MapStruct踩坑" class="headerlink" title="MapStruct踩坑"></a>MapStruct踩坑</h2><p>在引入MapStruct自动转换工具之后，出现了getter和setter全部无法识别的情况。检查之后发现是Spring Boot检测到MapStruct之后，把annotation processors设置中annotation profile for xx的设置,从obtain processors from peoject classpath更改为自定义路径选项，指向lombok了。</p>
<p>查阅资料之后发现：<strong>引入时，mapstruct-processor必须在lombok后面</strong>。</p>
<h3 id="顺序问题的根因"><a href="#顺序问题的根因" class="headerlink" title="顺序问题的根因"></a>顺序问题的根因</h3><h4 id="1-Lombok-的代码生成"><a href="#1-Lombok-的代码生成" class="headerlink" title="1. Lombok 的代码生成"></a>1. Lombok 的代码生成</h4><p>Lombok 使用注解处理器来生成代码，如 getter、setter、构造函数等。这些代码需要在任何依赖这些方法的注解处理器之前生成。</p>
<h4 id="2-MapStruct-的依赖"><a href="#2-MapStruct-的依赖" class="headerlink" title="2. MapStruct 的依赖"></a>2. MapStruct 的依赖</h4><p>MapStruct 依赖于完整的 Java 类，其中包含所有必要的 getter 和 setter 等方法。如果 Lombok 的注解处理器在 MapStruct 之后执行，则 MapStruct 无法看到 Lombok 生成的代码， MapStruct 将无法访问到 getter 和 setter 方法，从而导致编译错误或不完整的映射代码。</p>
<p>在找到根本原因之前，每次都是手动修改Setting，非常麻烦。</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2024/04/22/My-First-Post/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">My First Post</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2024 DouDou
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>